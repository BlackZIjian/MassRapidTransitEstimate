# 数据输入模块

## 系统架构

架构图

### 数据流模块

类图

生命周期图

#### 接口详细设计

接口名：InputStream::Open()

功能：创建一个可存储已知数据的数据流，不可修改

参数：数据长度，数据解码类型，数据

返回值：InputStream实例

算法描述：

+ 根据参数中的数据长度和数据解码类型计算出数据所占用的内存大小
+ 为成员变量data向内存申请计算大小的内存空间
+ 标记该流为繁忙状态
+ 调用内部Read()函数，将数据按顺序存储到申请的空间中
+ 将数据长度，数据格式赋值给data_length,data_type
+ 返回指向自身的指针或实例
+ 标记该流为空闲

接口流程：





接口名：InputStream::Close()

功能：关闭一个数据流并释放内存

参数：无

返回值：无

算法描述：

+ 释放掉data指向的流数据
+ 释放掉自身所占内存

接口流程：



接口名：OutputStream::Open()

功能：创建一个空的数据流对象，可以写入

参数：数据类型

返回值：OutputStream实例

算法描述：

+ 为自身申请一个内存空间
+ 将data_lenth赋值为0
+ 为data申请一个地址
+ 返回指向自身的指针或实例

接口流程：



接口名：OutputStream::Write()

功能：将数据写入到可写入的数据流中

参数：数据，数据长度，数据类型

返回值：无

算法描述：

+ 根据参数中的数据长度和数据解码类型计算出数据所占用的内存大小
+ 标记该流为繁忙状态
+ 为data追加相应大小的内存空间
+ 调用内部Read()函数，将数据按顺序存储到申请的空间中
+ 将数据长度追加data_length
+ 标记该流为空闲

接口流程：



接口名：OutputStream::Close()

功能：关闭一个数据流，并释放内存

参数：无

返回值：无

算法描述：

- 释放掉data指向的流数据
- 释放掉自身所占内存

接口流程：





### 数据转码模块

类图

生命周期图

#### 接口详细设计

接口名：FormatChanger::Read()

功能：创建一个转码器，并进行转码

参数：原数据

返回值：FormatChanger实例

算法描述：

+ 为成员变量result申请输入数据大小 * 48 /128大小的空间


+ 将输入数据按128位分割为一个temp数组
+ 对temp数组每一个元素循环做以下处理
  + 取0-31位，截取26-31位，追加到result
  + 取32-63位，截取58-63位，追加到result
  + 取64-95位，截取92-95位，追加到result
  + 取96到127位，追加到result
+ 释放掉temp数组

接口流程：





接口名：DataChanger::Output()

功能：取出转码后的结果并释放内存

参数：无

返回值：转码后数据

算法描述：

+ 新建二进制流变量output，值赋为result
+ 释放掉result内存空间
+ 传出output
+ 释放掉自身

接口流程：



### 数据压缩模块

类图

生命周期图

#### 接口详细设计

接口名：PatchChanger::Read()

功能：创建一个转码器，并进行转码

参数：原数据

返回值：PatchChanger实例

算法描述：

- 创建一个临时变量chars，类型为字符数组


- 创建一个临时变量p，类型为指针，指向原数据首地址

- 创建一个整型数组counts，数组大小为100，代表字符的出现次数，初始值为0

- 进行如下循环，直到p指向内存不可访问

  - 创建临时变量c,类型为char，值为p~p+7指向的内存数据
  - 将c追加到chars数组
  - 令counts[字符c对应ASCII码值]自增1
  - 令p = p + 8

- 对counts建立哈夫曼树，哈夫曼树的建立算法如下

  术语解释：

  **路径： 树中一个结点到另一个结点之间的分支构成这两个结点之间的路径。**

  ​

  **路径长度：路径上的分枝数目称作路径长度。**

  ​

  **树的路径长度：从树根到每一个结点的路径长度之和。**

  ​

  **结点的带权路径长度：在一棵树中，如果其结点上附带有一个权值，通常把该结点的路径长度与该结点上的权值之积称为该结点的带权路径长度（weighted path length）**
  ​

  **权值：计算机领域中（数据结构）权值就是定义的路径上面的值。可以这样理解为节点间的距离。通常指字符对应的二进制编码出现的概率。 至于哈夫曼树中的权值可以理解为：权值大表明出现概率大！一个结点的权值实际上就是这个结点子树在整个树中所占的比例. abcd四个叶子节点的权值为7,5,2,4. 这个7,5,2,4是根据实际情况得到的,比如说从一段文本中统计出abcd四个字母出现的次数分别为7,5,2,4. 说a结点的权值为7,意思是说a结点在系统中占有7这个份量.实际上也可以化为百分比来表示,但反而麻烦,实际上是一样的。 **

  ​

  **树的带权路径长度：如果树中每个叶子上都带有一个权值，则把树中所有叶子的带权路径长度之和称为树的带权路径长度。**

  构造算法

  ![]()

  ![]()

- 对生成的哈夫曼树进行遍历，规定左支代表0，右枝代表1，直到遍历完全部的叶子节点，由此得出每个字符对应的编码

- 为成员变量result申请chars长度 * 4的空间

- 将counts数组以二进制流追加到result中

- 遍历chars数组，做如下循环：

  - 获取字符char对应的编码
  - 将编码按二进制追加到result数组

-  返回指向自身的实例、

接口流程：





接口名：PatchChanger::Output()

功能：取出转码后的结果并释放内存

参数：无

返回值：转码后数据

算法描述：

- 新建二进制流变量output，值赋为result
- 释放掉result内存空间
- 传出output
- 释放掉自身

接口流程：



### 数据输入模块

类图

生命周期图

#### 接口详细设计

接口名：Bind()，绑定数据

功能：将用户输入的数据绑定到模块内部

参数：用户输入的数据

返回值：无

算法描述：

+ 创建对用户输入组件的监听函数，监听键盘释放onKeyUp事件
+ 当用户释放键盘按键时：
  + 获取到用户输入组件上的输入值
  + 更新成员变量datas，使其与用户输入相同

接口流程：



接口名：Submit()，提交数据

功能：将输入的数据提交到服务器

参数：无

返回值：当前已提交的数据量

算法描述：

+ 调用输入数据流的Open函数，传入datas
+ 创建临时变量data_send
+ 将数据流实例的数据拆分执行异步处理
  + 以部分数据创建转码器实例
  + 取出转码器实例结果数据，创建压缩器实例
  + 取出压缩器实例结果数据，传入数据发送实例
  + 返回发送数据量
+ data_send追加
+ 全部数据发送结束后通知数据搜集者

接口流程：





### 数据发送模块

类图

生命周期图

#### 接口详细设计

接口名：DataSend::Send()

功能：向模块外部发送一段数据，以路由的方式

参数：数据

返回值：发送量

算法描述：

+ 建立http.post请求，并为请求绑定success回调函数
+ 请求url为路由数据，data为数据
+ success函数返回发送的数据量

接口流程图：

